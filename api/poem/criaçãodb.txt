-- 1) Cria o schema (se ainda não existir)
CREATE DATABASE IF NOT EXISTS poemdb
  CHARACTER SET utf8mb4
  COLLATE utf8mb4_unicode_ci;
USE poemdb;

-- 2) Tabela de usuários
CREATE TABLE IF NOT EXISTS users (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  username VARCHAR(50) NOT NULL UNIQUE,
  email VARCHAR(100) NOT NULL UNIQUE,
  password VARCHAR(255) NOT NULL,
  role VARCHAR(20) NOT NULL,
  INDEX idx_users_email (email)
);

-- 3) Tabela de profiles, referenciando users.email
CREATE TABLE IF NOT EXISTS profiles (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  first_name VARCHAR(50) NOT NULL,
  last_name  VARCHAR(50) NOT NULL,
  phone      VARCHAR(20),
  user_email VARCHAR(100) NOT NULL UNIQUE,
  CONSTRAINT fk_profile_user FOREIGN KEY (user_email)
    REFERENCES users(email)
    ON UPDATE CASCADE
    ON DELETE CASCADE
);

-- 4) Tabela de poemas
CREATE TABLE poems (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255),
    text TEXT,
    author VARCHAR(255),
    image_url VARCHAR(255),
    post_date DATE
);